name: Monitoring & Alerts
on:
  schedule:
    - cron: '0 */12 * * *'
  workflow_run:
    workflows: ["Protection Anti-Sabotage"]
    types: [completed]
jobs:
  health-check:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: System health check
      run: |
        echo "ðŸ” VÃ©rification systÃ¨me..."
        
        # VÃ©rifier GitHub Pages
        STATUS=$(curl -s -o /dev/null -w "%{http_code}" "https://${{ github.repository_owner }}.github.io/LiberChat" || echo "000")
        if [ "$STATUS" != "200" ]; then
          echo "âŒ GitHub Pages inaccessible (Code: $STATUS)"
        else
          echo "âœ… GitHub Pages opÃ©rationnel"
        fi
        
        # VÃ©rifier les workflows
        if [ ! -f ".github/workflows/auto-invite.yml" ]; then
          echo "âŒ Workflow d'invitation manquant"
        else
          echo "âœ… Workflow d'invitation prÃ©sent"
        fi
        
        # Statistiques
        ISSUES_COUNT=$(find .github -name "*.yml" | wc -l)
        echo "ðŸ“Š Workflows actifs: $ISSUES_COUNT"
    
    - name: Generate report
      run: |
        DATE=$(date '+%Y-%m-%d %H:%M')
        cat > monitoring-report.md << EOF
        # ðŸ“Š Rapport de Monitoring - $DATE
        
        ## Ã‰tat du SystÃ¨me
        - âœ… Repo: OpÃ©rationnel
        - âœ… Actions: Fonctionnelles
        - âœ… Backups: Automatiques
        
        ## Statistiques
        - DerniÃ¨re vÃ©rification: $DATE
        - Workflows actifs: $(find .github/workflows -name "*.yml" | wc -l)
        - Taille repo: $(du -sh . | cut -f1)
        
        ## Actions RÃ©centes
        $(git log --oneline -5)
        EOF
    
    - name: Upload report
      uses: actions/upload-artifact@v4
      with:
        name: monitoring-report
        path: monitoring-report.md
        retention-days: 30